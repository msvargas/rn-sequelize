'use strict';

const _ = require('lodash');

const validator = _.cloneDeep(require('validator'));

const moment = require('moment');

const extensions = {
  extend(name, fn) {
    this[name] = fn;
    return this;
  },

  notEmpty(str) {
    return !str.match(/^[\s\t\r\n]*$/);
  },

  len(str, min, max) {
    return this.isLength(str, min, max);
  },

  isUrl(str) {
    return this.isURL(str);
  },

  isIPv6(str) {
    return this.isIP(str, 6);
  },

  isIPv4(str) {
    return this.isIP(str, 4);
  },

  notIn(str, values) {
    return !this.isIn(str, values);
  },

  regex(str, pattern, modifiers) {
    str += '';

    if (Object.prototype.toString.call(pattern).slice(8, -1) !== 'RegExp') {
      pattern = new RegExp(pattern, modifiers);
    }

    return str.match(pattern);
  },

  notRegex(str, pattern, modifiers) {
    return !this.regex(str, pattern, modifiers);
  },

  isDecimal(str) {
    return str !== '' && !!str.match(/^(?:-?(?:[0-9]+))?(?:\.[0-9]*)?(?:[eE][+-]?(?:[0-9]+))?$/);
  },

  min(str, val) {
    const number = parseFloat(str);
    return isNaN(number) || number >= val;
  },

  max(str, val) {
    const number = parseFloat(str);
    return isNaN(number) || number <= val;
  },

  not(str, pattern, modifiers) {
    return this.notRegex(str, pattern, modifiers);
  },

  contains(str, elem) {
    return !!elem && str.includes(elem);
  },

  notContains(str, elem) {
    return !this.contains(str, elem);
  },

  is(str, pattern, modifiers) {
    return this.regex(str, pattern, modifiers);
  }

};
exports.extensions = extensions; // instance based validators

validator.isImmutable = function (value, validatorArgs, field, modelInstance) {
  return modelInstance.isNewRecord || modelInstance.dataValues[field] === modelInstance._previousDataValues[field];
}; // extra validators


validator.notNull = function (val) {
  return val !== null && val !== undefined;
}; // https://github.com/chriso/validator.js/blob/6.2.0/validator.js


_.forEach(extensions, (extend, key) => {
  validator[key] = extend;
}); // map isNull to isEmpty
// https://github.com/chriso/validator.js/commit/e33d38a26ee2f9666b319adb67c7fc0d3dea7125


validator.isNull = validator.isEmpty; // isDate removed in 7.0.0
// https://github.com/chriso/validator.js/commit/095509fc707a4dc0e99f85131df1176ad6389fc9

validator.isDate = function (dateString) {
  // avoid http://momentjs.com/guides/#/warnings/js-date/
  // by doing a preliminary check on `dateString`
  const parsed = Date.parse(dateString);

  if (isNaN(parsed)) {
    // fail if we can't parse it
    return false;
  } // otherwise convert to ISO 8601 as moment prefers
  // http://momentjs.com/docs/#/parsing/string/


  const date = new Date(parsed);
  return moment(date.toISOString()).isValid();
};

exports.validator = validator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi91dGlscy92YWxpZGF0b3ItZXh0cmFzLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwidmFsaWRhdG9yIiwiY2xvbmVEZWVwIiwibW9tZW50IiwiZXh0ZW5zaW9ucyIsImV4dGVuZCIsIm5hbWUiLCJmbiIsIm5vdEVtcHR5Iiwic3RyIiwibWF0Y2giLCJsZW4iLCJtaW4iLCJtYXgiLCJpc0xlbmd0aCIsImlzVXJsIiwiaXNVUkwiLCJpc0lQdjYiLCJpc0lQIiwiaXNJUHY0Iiwibm90SW4iLCJ2YWx1ZXMiLCJpc0luIiwicmVnZXgiLCJwYXR0ZXJuIiwibW9kaWZpZXJzIiwiT2JqZWN0IiwicHJvdG90eXBlIiwidG9TdHJpbmciLCJjYWxsIiwic2xpY2UiLCJSZWdFeHAiLCJub3RSZWdleCIsImlzRGVjaW1hbCIsInZhbCIsIm51bWJlciIsInBhcnNlRmxvYXQiLCJpc05hTiIsIm5vdCIsImNvbnRhaW5zIiwiZWxlbSIsImluY2x1ZGVzIiwibm90Q29udGFpbnMiLCJpcyIsImV4cG9ydHMiLCJpc0ltbXV0YWJsZSIsInZhbHVlIiwidmFsaWRhdG9yQXJncyIsImZpZWxkIiwibW9kZWxJbnN0YW5jZSIsImlzTmV3UmVjb3JkIiwiZGF0YVZhbHVlcyIsIl9wcmV2aW91c0RhdGFWYWx1ZXMiLCJub3ROdWxsIiwidW5kZWZpbmVkIiwiZm9yRWFjaCIsImtleSIsImlzTnVsbCIsImlzRW1wdHkiLCJpc0RhdGUiLCJkYXRlU3RyaW5nIiwicGFyc2VkIiwiRGF0ZSIsInBhcnNlIiwiZGF0ZSIsInRvSVNPU3RyaW5nIiwiaXNWYWxpZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsQ0FBQyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFqQjs7QUFDQSxNQUFNQyxTQUFTLEdBQUdGLENBQUMsQ0FBQ0csU0FBRixDQUFZRixPQUFPLENBQUMsV0FBRCxDQUFuQixDQUFsQjs7QUFDQSxNQUFNRyxNQUFNLEdBQUdILE9BQU8sQ0FBQyxRQUFELENBQXRCOztBQUVBLE1BQU1JLFVBQVUsR0FBRztBQUNqQkMsRUFBQUEsTUFBTSxDQUFDQyxJQUFELEVBQU9DLEVBQVAsRUFBVztBQUNmLFNBQUtELElBQUwsSUFBYUMsRUFBYjtBQUVBLFdBQU8sSUFBUDtBQUNELEdBTGdCOztBQU1qQkMsRUFBQUEsUUFBUSxDQUFDQyxHQUFELEVBQU07QUFDWixXQUFPLENBQUNBLEdBQUcsQ0FBQ0MsS0FBSixDQUFVLGVBQVYsQ0FBUjtBQUNELEdBUmdCOztBQVNqQkMsRUFBQUEsR0FBRyxDQUFDRixHQUFELEVBQU1HLEdBQU4sRUFBV0MsR0FBWCxFQUFnQjtBQUNqQixXQUFPLEtBQUtDLFFBQUwsQ0FBY0wsR0FBZCxFQUFtQkcsR0FBbkIsRUFBd0JDLEdBQXhCLENBQVA7QUFDRCxHQVhnQjs7QUFZakJFLEVBQUFBLEtBQUssQ0FBQ04sR0FBRCxFQUFNO0FBQ1QsV0FBTyxLQUFLTyxLQUFMLENBQVdQLEdBQVgsQ0FBUDtBQUNELEdBZGdCOztBQWVqQlEsRUFBQUEsTUFBTSxDQUFDUixHQUFELEVBQU07QUFDVixXQUFPLEtBQUtTLElBQUwsQ0FBVVQsR0FBVixFQUFlLENBQWYsQ0FBUDtBQUNELEdBakJnQjs7QUFrQmpCVSxFQUFBQSxNQUFNLENBQUNWLEdBQUQsRUFBTTtBQUNWLFdBQU8sS0FBS1MsSUFBTCxDQUFVVCxHQUFWLEVBQWUsQ0FBZixDQUFQO0FBQ0QsR0FwQmdCOztBQXFCakJXLEVBQUFBLEtBQUssQ0FBQ1gsR0FBRCxFQUFNWSxNQUFOLEVBQWM7QUFDakIsV0FBTyxDQUFDLEtBQUtDLElBQUwsQ0FBVWIsR0FBVixFQUFlWSxNQUFmLENBQVI7QUFDRCxHQXZCZ0I7O0FBd0JqQkUsRUFBQUEsS0FBSyxDQUFDZCxHQUFELEVBQU1lLE9BQU4sRUFBZUMsU0FBZixFQUEwQjtBQUM3QmhCLElBQUFBLEdBQUcsSUFBSSxFQUFQOztBQUNBLFFBQUlpQixNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCQyxJQUExQixDQUErQkwsT0FBL0IsRUFBd0NNLEtBQXhDLENBQThDLENBQTlDLEVBQWlELENBQUMsQ0FBbEQsTUFBeUQsUUFBN0QsRUFBdUU7QUFDckVOLE1BQUFBLE9BQU8sR0FBRyxJQUFJTyxNQUFKLENBQVdQLE9BQVgsRUFBb0JDLFNBQXBCLENBQVY7QUFDRDs7QUFDRCxXQUFPaEIsR0FBRyxDQUFDQyxLQUFKLENBQVVjLE9BQVYsQ0FBUDtBQUNELEdBOUJnQjs7QUErQmpCUSxFQUFBQSxRQUFRLENBQUN2QixHQUFELEVBQU1lLE9BQU4sRUFBZUMsU0FBZixFQUEwQjtBQUNoQyxXQUFPLENBQUMsS0FBS0YsS0FBTCxDQUFXZCxHQUFYLEVBQWdCZSxPQUFoQixFQUF5QkMsU0FBekIsQ0FBUjtBQUNELEdBakNnQjs7QUFrQ2pCUSxFQUFBQSxTQUFTLENBQUN4QixHQUFELEVBQU07QUFDYixXQUFPQSxHQUFHLEtBQUssRUFBUixJQUFjLENBQUMsQ0FBQ0EsR0FBRyxDQUFDQyxLQUFKLENBQVUsMERBQVYsQ0FBdkI7QUFDRCxHQXBDZ0I7O0FBcUNqQkUsRUFBQUEsR0FBRyxDQUFDSCxHQUFELEVBQU15QixHQUFOLEVBQVc7QUFDWixVQUFNQyxNQUFNLEdBQUdDLFVBQVUsQ0FBQzNCLEdBQUQsQ0FBekI7QUFDQSxXQUFPNEIsS0FBSyxDQUFDRixNQUFELENBQUwsSUFBaUJBLE1BQU0sSUFBSUQsR0FBbEM7QUFDRCxHQXhDZ0I7O0FBeUNqQnJCLEVBQUFBLEdBQUcsQ0FBQ0osR0FBRCxFQUFNeUIsR0FBTixFQUFXO0FBQ1osVUFBTUMsTUFBTSxHQUFHQyxVQUFVLENBQUMzQixHQUFELENBQXpCO0FBQ0EsV0FBTzRCLEtBQUssQ0FBQ0YsTUFBRCxDQUFMLElBQWlCQSxNQUFNLElBQUlELEdBQWxDO0FBQ0QsR0E1Q2dCOztBQTZDakJJLEVBQUFBLEdBQUcsQ0FBQzdCLEdBQUQsRUFBTWUsT0FBTixFQUFlQyxTQUFmLEVBQTBCO0FBQzNCLFdBQU8sS0FBS08sUUFBTCxDQUFjdkIsR0FBZCxFQUFtQmUsT0FBbkIsRUFBNEJDLFNBQTVCLENBQVA7QUFDRCxHQS9DZ0I7O0FBZ0RqQmMsRUFBQUEsUUFBUSxDQUFDOUIsR0FBRCxFQUFNK0IsSUFBTixFQUFZO0FBQ2xCLFdBQU8sQ0FBQyxDQUFDQSxJQUFGLElBQVUvQixHQUFHLENBQUNnQyxRQUFKLENBQWFELElBQWIsQ0FBakI7QUFDRCxHQWxEZ0I7O0FBbURqQkUsRUFBQUEsV0FBVyxDQUFDakMsR0FBRCxFQUFNK0IsSUFBTixFQUFZO0FBQ3JCLFdBQU8sQ0FBQyxLQUFLRCxRQUFMLENBQWM5QixHQUFkLEVBQW1CK0IsSUFBbkIsQ0FBUjtBQUNELEdBckRnQjs7QUFzRGpCRyxFQUFBQSxFQUFFLENBQUNsQyxHQUFELEVBQU1lLE9BQU4sRUFBZUMsU0FBZixFQUEwQjtBQUMxQixXQUFPLEtBQUtGLEtBQUwsQ0FBV2QsR0FBWCxFQUFnQmUsT0FBaEIsRUFBeUJDLFNBQXpCLENBQVA7QUFDRDs7QUF4RGdCLENBQW5CO0FBMERBbUIsT0FBTyxDQUFDeEMsVUFBUixHQUFxQkEsVUFBckIsQyxDQUVBOztBQUNBSCxTQUFTLENBQUM0QyxXQUFWLEdBQXdCLFVBQVNDLEtBQVQsRUFBZ0JDLGFBQWhCLEVBQStCQyxLQUEvQixFQUFzQ0MsYUFBdEMsRUFBcUQ7QUFDM0UsU0FBT0EsYUFBYSxDQUFDQyxXQUFkLElBQTZCRCxhQUFhLENBQUNFLFVBQWQsQ0FBeUJILEtBQXpCLE1BQW9DQyxhQUFhLENBQUNHLG1CQUFkLENBQWtDSixLQUFsQyxDQUF4RTtBQUNELENBRkQsQyxDQUlBOzs7QUFDQS9DLFNBQVMsQ0FBQ29ELE9BQVYsR0FBb0IsVUFBU25CLEdBQVQsRUFBYztBQUNoQyxTQUFPQSxHQUFHLEtBQUssSUFBUixJQUFnQkEsR0FBRyxLQUFLb0IsU0FBL0I7QUFDRCxDQUZELEMsQ0FJQTs7O0FBQ0F2RCxDQUFDLENBQUN3RCxPQUFGLENBQVVuRCxVQUFWLEVBQXNCLENBQUNDLE1BQUQsRUFBU21ELEdBQVQsS0FBaUI7QUFDckN2RCxFQUFBQSxTQUFTLENBQUN1RCxHQUFELENBQVQsR0FBaUJuRCxNQUFqQjtBQUNELENBRkQsRSxDQUlBO0FBQ0E7OztBQUNBSixTQUFTLENBQUN3RCxNQUFWLEdBQW1CeEQsU0FBUyxDQUFDeUQsT0FBN0IsQyxDQUVBO0FBQ0E7O0FBQ0F6RCxTQUFTLENBQUMwRCxNQUFWLEdBQW1CLFVBQVNDLFVBQVQsRUFBcUI7QUFDdEM7QUFDQTtBQUNBLFFBQU1DLE1BQU0sR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVdILFVBQVgsQ0FBZjs7QUFDQSxNQUFJdkIsS0FBSyxDQUFDd0IsTUFBRCxDQUFULEVBQW1CO0FBQ2pCO0FBQ0EsV0FBTyxLQUFQO0FBQ0QsR0FQcUMsQ0FRdEM7QUFDQTs7O0FBQ0EsUUFBTUcsSUFBSSxHQUFHLElBQUlGLElBQUosQ0FBU0QsTUFBVCxDQUFiO0FBQ0EsU0FBTzFELE1BQU0sQ0FBQzZELElBQUksQ0FBQ0MsV0FBTCxFQUFELENBQU4sQ0FBMkJDLE9BQTNCLEVBQVA7QUFDRCxDQVpEOztBQWNBdEIsT0FBTyxDQUFDM0MsU0FBUixHQUFvQkEsU0FBcEIiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcbmNvbnN0IHZhbGlkYXRvciA9IF8uY2xvbmVEZWVwKHJlcXVpcmUoJ3ZhbGlkYXRvcicpKTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xuXG5jb25zdCBleHRlbnNpb25zID0ge1xuICBleHRlbmQobmFtZSwgZm4pIHtcbiAgICB0aGlzW25hbWVdID0gZm47XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgbm90RW1wdHkoc3RyKSB7XG4gICAgcmV0dXJuICFzdHIubWF0Y2goL15bXFxzXFx0XFxyXFxuXSokLyk7XG4gIH0sXG4gIGxlbihzdHIsIG1pbiwgbWF4KSB7XG4gICAgcmV0dXJuIHRoaXMuaXNMZW5ndGgoc3RyLCBtaW4sIG1heCk7XG4gIH0sXG4gIGlzVXJsKHN0cikge1xuICAgIHJldHVybiB0aGlzLmlzVVJMKHN0cik7XG4gIH0sXG4gIGlzSVB2NihzdHIpIHtcbiAgICByZXR1cm4gdGhpcy5pc0lQKHN0ciwgNik7XG4gIH0sXG4gIGlzSVB2NChzdHIpIHtcbiAgICByZXR1cm4gdGhpcy5pc0lQKHN0ciwgNCk7XG4gIH0sXG4gIG5vdEluKHN0ciwgdmFsdWVzKSB7XG4gICAgcmV0dXJuICF0aGlzLmlzSW4oc3RyLCB2YWx1ZXMpO1xuICB9LFxuICByZWdleChzdHIsIHBhdHRlcm4sIG1vZGlmaWVycykge1xuICAgIHN0ciArPSAnJztcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHBhdHRlcm4pLnNsaWNlKDgsIC0xKSAhPT0gJ1JlZ0V4cCcpIHtcbiAgICAgIHBhdHRlcm4gPSBuZXcgUmVnRXhwKHBhdHRlcm4sIG1vZGlmaWVycyk7XG4gICAgfVxuICAgIHJldHVybiBzdHIubWF0Y2gocGF0dGVybik7XG4gIH0sXG4gIG5vdFJlZ2V4KHN0ciwgcGF0dGVybiwgbW9kaWZpZXJzKSB7XG4gICAgcmV0dXJuICF0aGlzLnJlZ2V4KHN0ciwgcGF0dGVybiwgbW9kaWZpZXJzKTtcbiAgfSxcbiAgaXNEZWNpbWFsKHN0cikge1xuICAgIHJldHVybiBzdHIgIT09ICcnICYmICEhc3RyLm1hdGNoKC9eKD86LT8oPzpbMC05XSspKT8oPzpcXC5bMC05XSopPyg/OltlRV1bKy1dPyg/OlswLTldKykpPyQvKTtcbiAgfSxcbiAgbWluKHN0ciwgdmFsKSB7XG4gICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdChzdHIpO1xuICAgIHJldHVybiBpc05hTihudW1iZXIpIHx8IG51bWJlciA+PSB2YWw7XG4gIH0sXG4gIG1heChzdHIsIHZhbCkge1xuICAgIGNvbnN0IG51bWJlciA9IHBhcnNlRmxvYXQoc3RyKTtcbiAgICByZXR1cm4gaXNOYU4obnVtYmVyKSB8fCBudW1iZXIgPD0gdmFsO1xuICB9LFxuICBub3Qoc3RyLCBwYXR0ZXJuLCBtb2RpZmllcnMpIHtcbiAgICByZXR1cm4gdGhpcy5ub3RSZWdleChzdHIsIHBhdHRlcm4sIG1vZGlmaWVycyk7XG4gIH0sXG4gIGNvbnRhaW5zKHN0ciwgZWxlbSkge1xuICAgIHJldHVybiAhIWVsZW0gJiYgc3RyLmluY2x1ZGVzKGVsZW0pO1xuICB9LFxuICBub3RDb250YWlucyhzdHIsIGVsZW0pIHtcbiAgICByZXR1cm4gIXRoaXMuY29udGFpbnMoc3RyLCBlbGVtKTtcbiAgfSxcbiAgaXMoc3RyLCBwYXR0ZXJuLCBtb2RpZmllcnMpIHtcbiAgICByZXR1cm4gdGhpcy5yZWdleChzdHIsIHBhdHRlcm4sIG1vZGlmaWVycyk7XG4gIH1cbn07XG5leHBvcnRzLmV4dGVuc2lvbnMgPSBleHRlbnNpb25zO1xuXG4vLyBpbnN0YW5jZSBiYXNlZCB2YWxpZGF0b3JzXG52YWxpZGF0b3IuaXNJbW11dGFibGUgPSBmdW5jdGlvbih2YWx1ZSwgdmFsaWRhdG9yQXJncywgZmllbGQsIG1vZGVsSW5zdGFuY2UpIHtcbiAgcmV0dXJuIG1vZGVsSW5zdGFuY2UuaXNOZXdSZWNvcmQgfHwgbW9kZWxJbnN0YW5jZS5kYXRhVmFsdWVzW2ZpZWxkXSA9PT0gbW9kZWxJbnN0YW5jZS5fcHJldmlvdXNEYXRhVmFsdWVzW2ZpZWxkXTtcbn07XG5cbi8vIGV4dHJhIHZhbGlkYXRvcnNcbnZhbGlkYXRvci5ub3ROdWxsID0gZnVuY3Rpb24odmFsKSB7XG4gIHJldHVybiB2YWwgIT09IG51bGwgJiYgdmFsICE9PSB1bmRlZmluZWQ7XG59O1xuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vY2hyaXNvL3ZhbGlkYXRvci5qcy9ibG9iLzYuMi4wL3ZhbGlkYXRvci5qc1xuXy5mb3JFYWNoKGV4dGVuc2lvbnMsIChleHRlbmQsIGtleSkgPT4ge1xuICB2YWxpZGF0b3Jba2V5XSA9IGV4dGVuZDtcbn0pO1xuXG4vLyBtYXAgaXNOdWxsIHRvIGlzRW1wdHlcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9jaHJpc28vdmFsaWRhdG9yLmpzL2NvbW1pdC9lMzNkMzhhMjZlZTJmOTY2NmIzMTlhZGI2N2M3ZmMwZDNkZWE3MTI1XG52YWxpZGF0b3IuaXNOdWxsID0gdmFsaWRhdG9yLmlzRW1wdHk7XG5cbi8vIGlzRGF0ZSByZW1vdmVkIGluIDcuMC4wXG4vLyBodHRwczovL2dpdGh1Yi5jb20vY2hyaXNvL3ZhbGlkYXRvci5qcy9jb21taXQvMDk1NTA5ZmM3MDdhNGRjMGU5OWY4NTEzMWRmMTE3NmFkNjM4OWZjOVxudmFsaWRhdG9yLmlzRGF0ZSA9IGZ1bmN0aW9uKGRhdGVTdHJpbmcpIHtcbiAgLy8gYXZvaWQgaHR0cDovL21vbWVudGpzLmNvbS9ndWlkZXMvIy93YXJuaW5ncy9qcy1kYXRlL1xuICAvLyBieSBkb2luZyBhIHByZWxpbWluYXJ5IGNoZWNrIG9uIGBkYXRlU3RyaW5nYFxuICBjb25zdCBwYXJzZWQgPSBEYXRlLnBhcnNlKGRhdGVTdHJpbmcpO1xuICBpZiAoaXNOYU4ocGFyc2VkKSkge1xuICAgIC8vIGZhaWwgaWYgd2UgY2FuJ3QgcGFyc2UgaXRcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgLy8gb3RoZXJ3aXNlIGNvbnZlcnQgdG8gSVNPIDg2MDEgYXMgbW9tZW50IHByZWZlcnNcbiAgLy8gaHR0cDovL21vbWVudGpzLmNvbS9kb2NzLyMvcGFyc2luZy9zdHJpbmcvXG4gIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShwYXJzZWQpO1xuICByZXR1cm4gbW9tZW50KGRhdGUudG9JU09TdHJpbmcoKSkuaXNWYWxpZCgpO1xufTtcblxuZXhwb3J0cy52YWxpZGF0b3IgPSB2YWxpZGF0b3I7XG4iXX0=